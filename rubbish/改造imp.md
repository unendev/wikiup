# 项目实现蓝图：AI驱动的《饥荒》世界知识探索平台 (V3.1 - 精简开发计划)

## 1. 后端开发重点与路线图

### 核心服务架构 (已完成)
- ✅ **分层架构重构**
  - 业务逻辑与WebSocket处理分离
  - 服务注入与依赖管理规范化

### 向量检索引擎 (基本完成)
- ✅ **基础向量检索功能**
  - `VectorDBService` 实现内存向量库
  - 文档加载与分块策略
  - 余弦相似度搜索实现
  
- ✅ **向量检索优化**
  - [x] 优化文本分块策略（考虑语义完整性）
  - [x] 添加相关度阈值过滤
  - [x] 实现简单的文档元数据存储
  - [x] **增强源文档追溯能力**：确保每个回答都能链接到具体源文档、章节和段落
  - [x] **实现向量磁盘化**：优化处理大规模知识库的性能

### 嵌入模型服务 (已完成)
- ✅ **基础嵌入服务**
  - `EmbeddingService` 与 `EmbeddingModel` 分离
  - DJL模型加载与推理封装
  
- ✅ **嵌入模型优化**
  - [x] 配置paraphrase-multilingual-MiniLM-L12-v2模型（支持中文）
  - [x] 调整相似度阈值以提高召回率

### 测试环境配置 (已完成)
- ✅ **单元测试环境**
  - 解决WebSocket测试配置问题
  - 配置测试专用属性文件
  - 实现模拟服务注入

### 知识库管理 (部分完成)
- 🚧 **知识库加载与更新** (进度：50%)
  - [x] 实现向量数据库磁盘持久化
  - [ ] 实现 `/api/v1/admin/kb/load` 异步接口
  - [ ] 添加知识库状态查询接口

### LLM集成 (部分完成)
- 🚧 **DeepSeek API集成** (进度：80%)
  - [x] 实现DeepSeek API连接器
  - [x] 设计提示工程模板
  - [x] 添加请求重试与错误处理
  - [x] 实现流式响应处理
  - [ ] 优化提示工程，提高回答质量

## 2. 技术选型与依赖管理

### 嵌入模型
- **当前状态:** 已配置并使用paraphrase-multilingual-MiniLM-L12-v2模型（支持中文，维度384）
- **后续优化:** 
  - 添加模型缓存机制提高性能
  - 考虑根据领域特点微调模型

### 向量索引
- **当前状态:** 已实现磁盘持久化和基于标题的文本分块，支持源文档追溯
- **后续优化:**
  - 考虑使用高级索引结构提高大规模性能
  - 添加增量更新机制

### LLM选项
- **当前状态:** 已集成DeepSeek API，实现流式响应
- **后续优化:**
  - 优化提示工程，提高回答质量和准确性
  - 添加错误处理和回退机制

## 3. 前端开发计划 (部分完成)

### 已完成功能
- ✅ **基础聊天界面**
  - WebSocket连接
  - 消息展示与输入
  - Markdown渲染
  - 流式响应显示
  - 源文档引用展示

### 待开发功能
- 📝 **用户体验优化** (进度：50%)
  - [x] 添加加载状态指示
  - [ ] 实现简单的错误处理
  - [x] **添加源文档引用展示**：在AI回答中展示引用的源文档链接

## 4. 下一步行动计划（优先级排序）

1. **实现知识库管理API** - 开发异步加载功能
2. **添加增量更新机制** - 支持仅处理新增或更改的文档
3. **完善错误处理** - 添加前后端错误处理机制
4. **优化提示工程** - 提高LLM回答质量
5. **添加用户认证** - 实现基本的用户认证功能

--- 